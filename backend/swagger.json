{"openapi":"3.0.3","info":{"title":"Trading Platform API","description":"High-performance trading backend built with Bun + Elysia + DrizzleORM + Redis","version":"1.0.0"},"tags":[{"name":"Users","description":"User management"},{"name":"Currencies","description":"Currency management"},{"name":"Orders","description":"Order management"},{"name":"Auth","description":"Authentication & SIWE login"},{"name":"Trade","description":"Trading engine (spot/leverage/perpetual/binary)"},{"name":"Admin","description":"Admin management"},{"name":"Market","description":"Market data (Redis-backed)"}],"paths":{"/health":{"get":{"operationId":"getHealth","tags":["Health"],"summary":"Health check endpoint","responses":{"200":{}}}},"/auth/login":{"post":{"parameters":[],"responses":{"200":{"$id":"#/components/schemas/auth.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/auth.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/auth.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/auth.response"}}}}},"operationId":"postAuthLogin","tags":["Auth"],"summary":"Login with wallet signature (SIWE). Auto-registers new users.","description":"Accepts a wallet address, SIWE message, and signature. Verifies the signature via viem. If the address is new, auto-registers with a unique 8-digit numeric UID. Returns a JWT token on success.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/auth.login"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/auth.login"}},"text/plain":{"schema":{"$ref":"#/components/schemas/auth.login"}}}}}},"/auth/me":{"get":{"operationId":"getAuthMe","tags":["Auth"],"summary":"Get current user from JWT","description":"Pass Bearer token in Authorization header to retrieve user info.","responses":{"200":{}}}},"/users/":{"post":{"parameters":[],"responses":{"200":{"$id":"#/components/schemas/user.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/user.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/user.response"}}}}},"operationId":"postUsers","tags":["Users"],"summary":"Create a new user by wallet address","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/user.create"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/user.create"}},"text/plain":{"schema":{"$ref":"#/components/schemas/user.create"}}}}},"get":{"operationId":"getUsers","tags":["Users"],"summary":"List all users","responses":{"200":{}}}},"/users/{uid}":{"get":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"uid","required":true}],"responses":{"200":{"$id":"#/components/schemas/user.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/user.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/user.response"}}}}},"operationId":"getUsersByUid","tags":["Users"],"summary":"Get user by UID"},"patch":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"uid","required":true}],"responses":{"200":{"$id":"#/components/schemas/user.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/user.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/user.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/user.response"}}}}},"operationId":"patchUsersByUid","tags":["Users"],"summary":"Update user fields","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/user.update"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/user.update"}},"text/plain":{"schema":{"$ref":"#/components/schemas/user.update"}}}}}},"/currencies/":{"post":{"parameters":[],"responses":{"200":{"$id":"#/components/schemas/currency.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/currency.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/currency.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/currency.response"}}}}},"operationId":"postCurrencies","tags":["Currencies"],"summary":"Add a new currency","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/currency.create"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/currency.create"}},"text/plain":{"schema":{"$ref":"#/components/schemas/currency.create"}}}}},"get":{"operationId":"getCurrencies","tags":["Currencies"],"summary":"List all currencies","responses":{"200":{}}}},"/currencies/{symbol}/toggle":{"patch":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"symbol","required":true}],"responses":{"200":{"$id":"#/components/schemas/currency.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/currency.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/currency.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/currency.response"}}}}},"operationId":"patchCurrenciesBySymbolToggle","tags":["Currencies"],"summary":"Toggle currency active status"}},"/orders/":{"post":{"parameters":[],"responses":{"200":{"$id":"#/components/schemas/order.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/order.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/order.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/order.response"}}}}},"operationId":"postOrders","tags":["Orders"],"summary":"Open a new order","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/order.create"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/order.create"}},"text/plain":{"schema":{"$ref":"#/components/schemas/order.create"}}}}}},"/orders/user/{uid}":{"get":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"uid","required":true}],"operationId":"getOrdersUserByUid","tags":["Orders"],"summary":"Get all orders for a user","responses":{"200":{}}}},"/orders/{id}/close":{"post":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"responses":{"200":{"$id":"#/components/schemas/order.response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/order.response"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/order.response"}},"text/plain":{"schema":{"$ref":"#/components/schemas/order.response"}}}}},"operationId":"postOrdersByIdClose","tags":["Orders"],"summary":"Close an open order","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/order.close"}},"multipart/form-data":{"schema":{"$ref":"#/components/schemas/order.close"}},"text/plain":{"schema":{"$ref":"#/components/schemas/order.close"}}}}}},"/trade/spot/open":{"post":{"parameters":[],"operationId":"postTradeSpotOpen","tags":["Trade"],"summary":"Open a spot order (1x leverage)","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","direction","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"margin":{"type":"string"}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","direction","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"margin":{"type":"string"}}}},"text/plain":{"schema":{"type":"object","required":["symbol","direction","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"margin":{"type":"string"}}}}}},"responses":{"200":{}}}},"/trade/leverage/open":{"post":{"parameters":[],"operationId":"postTradeLeverageOpen","tags":["Trade"],"summary":"Open a leverage order (2x-200x)","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":2,"maximum":200,"type":"number"},"margin":{"type":"string"}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":2,"maximum":200,"type":"number"},"margin":{"type":"string"}}}},"text/plain":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":2,"maximum":200,"type":"number"},"margin":{"type":"string"}}}}}},"responses":{"200":{}}}},"/trade/perpetual/open":{"post":{"parameters":[],"operationId":"postTradePerpetualOpen","tags":["Trade"],"summary":"Open a perpetual contract order","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":1,"maximum":200,"type":"number"},"margin":{"type":"string"}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":1,"maximum":200,"type":"number"},"margin":{"type":"string"}}}},"text/plain":{"schema":{"type":"object","required":["symbol","direction","leverage","margin"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":1,"maximum":200,"type":"number"},"margin":{"type":"string"}}}}}},"responses":{"200":{}}}},"/trade/binary/open":{"post":{"parameters":[],"operationId":"postTradeBinaryOpen","tags":["Trade"],"summary":"Open a binary option (秒合约)","description":"Direction = long(涨)/short(跌). Seconds = 30/60/120/300. Auto-settles after the timer expires by comparing Redis price.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","direction","amount","seconds"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"amount":{"type":"string"},"seconds":{"anyOf":[{"const":30,"type":"number"},{"const":60,"type":"number"},{"const":120,"type":"number"},{"const":300,"type":"number"}]}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","direction","amount","seconds"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"amount":{"type":"string"},"seconds":{"anyOf":[{"const":30,"type":"number"},{"const":60,"type":"number"},{"const":120,"type":"number"},{"const":300,"type":"number"}]}}}},"text/plain":{"schema":{"type":"object","required":["symbol","direction","amount","seconds"],"properties":{"symbol":{"minLength":1,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"amount":{"type":"string"},"seconds":{"anyOf":[{"const":30,"type":"number"},{"const":60,"type":"number"},{"const":120,"type":"number"},{"const":300,"type":"number"}]}}}}}},"responses":{"200":{}}}},"/trade/{id}/close":{"post":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"id","required":true}],"operationId":"postTradeByIdClose","tags":["Trade"],"summary":"Close an open order (spot/leverage/perpetual)","responses":{"200":{}}}},"/admin/coin/add":{"post":{"parameters":[],"operationId":"postAdminCoinAdd","tags":["Admin"],"summary":"Add a new coin/currency","description":"Adds a new currency to the DB and initializes a Redis price queue for real-time price feed.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","type"],"properties":{"symbol":{"minLength":1,"maxLength":20,"type":"string"},"type":{"anyOf":[{"const":"spot","type":"string"},{"const":"contract","type":"string"}]}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","type"],"properties":{"symbol":{"minLength":1,"maxLength":20,"type":"string"},"type":{"anyOf":[{"const":"spot","type":"string"},{"const":"contract","type":"string"}]}}}},"text/plain":{"schema":{"type":"object","required":["symbol","type"],"properties":{"symbol":{"minLength":1,"maxLength":20,"type":"string"},"type":{"anyOf":[{"const":"spot","type":"string"},{"const":"contract","type":"string"}]}}}}}},"responses":{"200":{}}}},"/admin/price/push":{"post":{"parameters":[],"operationId":"postAdminPricePush","tags":["Admin"],"summary":"Push a price tick into Redis","description":"Simulates a market data feed. Pushes a price into the Redis price queue for a symbol.","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["symbol","price"],"properties":{"symbol":{"minLength":1,"type":"string"},"price":{"type":"string"}}}},"multipart/form-data":{"schema":{"type":"object","required":["symbol","price"],"properties":{"symbol":{"minLength":1,"type":"string"},"price":{"type":"string"}}}},"text/plain":{"schema":{"type":"object","required":["symbol","price"],"properties":{"symbol":{"minLength":1,"type":"string"},"price":{"type":"string"}}}}}},"responses":{"200":{}}}},"/admin/coin/{symbol}/toggle":{"patch":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"symbol","required":true}],"operationId":"patchAdminCoinBySymbolToggle","tags":["Admin"],"summary":"Toggle a coin's active status","responses":{"200":{}}}},"/admin/user/{uid}/risk":{"patch":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"uid","required":true}],"operationId":"patchAdminUserByUidRisk","tags":["Admin"],"summary":"Set a user's risk level","description":"low = normal, medium = forced slippage + leverage cap, high = trading disabled","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["riskLevel"],"properties":{"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]}}}},"multipart/form-data":{"schema":{"type":"object","required":["riskLevel"],"properties":{"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]}}}},"text/plain":{"schema":{"type":"object","required":["riskLevel"],"properties":{"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]}}}}}},"responses":{"200":{}}}},"/admin/user/{uid}/freeze":{"patch":{"parameters":[{"schema":{"type":"string"},"in":"path","name":"uid","required":true}],"operationId":"patchAdminUserByUidFreeze","tags":["Admin"],"summary":"Freeze or unfreeze a user account","requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["frozen"],"properties":{"frozen":{"type":"boolean"}}}},"multipart/form-data":{"schema":{"type":"object","required":["frozen"],"properties":{"frozen":{"type":"boolean"}}}},"text/plain":{"schema":{"type":"object","required":["frozen"],"properties":{"frozen":{"type":"boolean"}}}}}},"responses":{"200":{}}}}},"components":{"schemas":{"user.create":{"type":"object","required":["address"],"properties":{"address":{"minLength":1,"maxLength":256,"type":"string"}},"$id":"#/components/schemas/user.create"},"user.response":{"type":"object","required":["id","address","uid","balanceUsdt","isFrozen","riskLevel","createdAt","updatedAt"],"properties":{"id":{"type":"string"},"address":{"type":"string"},"uid":{"type":"string"},"balanceUsdt":{"type":"string"},"isFrozen":{"type":"boolean"},"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]},"createdAt":{"type":"string"},"updatedAt":{"type":"string"}},"$id":"#/components/schemas/user.response"},"user.update":{"type":"object","properties":{"balanceUsdt":{"type":"string"},"isFrozen":{"type":"boolean"},"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]}},"$id":"#/components/schemas/user.update"},"currency.create":{"type":"object","required":["symbol","type"],"properties":{"symbol":{"minLength":1,"maxLength":20,"type":"string"},"type":{"anyOf":[{"const":"spot","type":"string"},{"const":"contract","type":"string"}]}},"$id":"#/components/schemas/currency.create"},"currency.response":{"type":"object","required":["id","symbol","type","activeStatus","createdAt"],"properties":{"id":{"type":"number"},"symbol":{"type":"string"},"type":{"anyOf":[{"const":"spot","type":"string"},{"const":"contract","type":"string"}]},"activeStatus":{"type":"boolean"},"createdAt":{"type":"string"}},"$id":"#/components/schemas/currency.response"},"order.create":{"type":"object","required":["uid","symbol","direction","leverage","margin"],"properties":{"uid":{"minLength":8,"maxLength":8,"type":"string"},"symbol":{"minLength":1,"maxLength":20,"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"minimum":1,"maximum":200,"type":"number"},"margin":{"type":"string"}},"$id":"#/components/schemas/order.create"},"order.response":{"type":"object","required":["id","uid","symbol","direction","leverage","margin","entryPrice","exitPrice","pnl","status","createdAt","closedAt"],"properties":{"id":{"type":"string"},"uid":{"type":"string"},"symbol":{"type":"string"},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"type":"number"},"margin":{"type":"string"},"entryPrice":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"exitPrice":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"pnl":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"status":{"anyOf":[{"const":"open","type":"string"},{"const":"closed","type":"string"},{"const":"liquidated","type":"string"}]},"createdAt":{"type":"string"},"closedAt":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]}},"$id":"#/components/schemas/order.response"},"order.close":{"type":"object","required":["exitPrice"],"properties":{"exitPrice":{"type":"string"}},"$id":"#/components/schemas/order.close"},"trade.response":{"type":"object","required":["id","uid","symbol","productType","direction","leverage","margin","entryPrice","exitPrice","pnl","status","binarySeconds","payoutRate","createdAt","closedAt"],"properties":{"id":{"type":"string"},"uid":{"type":"string"},"symbol":{"type":"string"},"productType":{"anyOf":[{"const":"spot","type":"string"},{"const":"leverage","type":"string"},{"const":"perpetual","type":"string"},{"const":"binary","type":"string"}]},"direction":{"anyOf":[{"const":"long","type":"string"},{"const":"short","type":"string"}]},"leverage":{"type":"number"},"margin":{"type":"string"},"entryPrice":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"exitPrice":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"pnl":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"status":{"type":"string"},"binarySeconds":{"nullable":true,"anyOf":[{"type":"number"},{"type":"null"}]},"payoutRate":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]},"createdAt":{"type":"string"},"closedAt":{"nullable":true,"anyOf":[{"type":"string"},{"type":"null"}]}},"$id":"#/components/schemas/trade.response"},"auth.login":{"type":"object","required":["wallet_address","signature","message"],"properties":{"wallet_address":{"minLength":1,"maxLength":256,"type":"string"},"signature":{"minLength":1,"type":"string"},"message":{"minLength":1,"type":"string"}},"$id":"#/components/schemas/auth.login"},"auth.response":{"type":"object","required":["token","user","isNewUser"],"properties":{"token":{"type":"string"},"user":{"type":"object","required":["uid","address","balanceUsdt","isFrozen","riskLevel"],"properties":{"uid":{"type":"string"},"address":{"type":"string"},"balanceUsdt":{"type":"string"},"isFrozen":{"type":"boolean"},"riskLevel":{"anyOf":[{"const":"low","type":"string"},{"const":"medium","type":"string"},{"const":"high","type":"string"}]}}},"isNewUser":{"type":"boolean"}},"$id":"#/components/schemas/auth.response"},"common.message":{"type":"object","required":["message"],"properties":{"message":{"type":"string"}},"$id":"#/components/schemas/common.message"},"common.id":{"type":"object","required":["id"],"properties":{"id":{"type":"string"}},"$id":"#/components/schemas/common.id"}}}}